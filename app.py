import streamlit as st
import pandas as pd
import yfinance as yf

# ==========================================
# ‚öôÔ∏è CONFIG & ENGINE (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ï‡πã‡∏á + RSI)
# ==========================================
st.set_page_config(page_title="GeminiBo v3.3: Whale Rider", page_icon="üèóÔ∏è", layout="wide")
FEE_RATE, VAT_RATE = 0.00157, 0.07

def get_accurate_rsi(symbol):
    try:
        ticker = yf.Ticker(f"{symbol}.BK")
        df = ticker.history(period="2mo", interval="1d")
        if df.empty or len(df) < 20: return 0.0, 50.0
        delta = df['Close'].diff()
        gain, loss = delta.clip(lower=0), -1 * delta.clip(upper=0)
        ma_g, ma_l = gain.rolling(window=14).mean(), loss.rolling(window=14).mean()
        rs = ma_g / ma_l
        rsi = 100 - (100 / (1 + rs))
        return float(df['Close'].iloc[-1]), float(rsi.iloc[-1])
    except: return 0.0, 50.0

# ==========================================
# üìä STRATEGIST DASHBOARD (‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡∏™‡∏π‡πâ‡πÄ‡∏à‡πâ‡∏≤)
# ==========================================
st.sidebar.title("üèóÔ∏è GeminiBo v3.3")
menu = st.sidebar.radio("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î", ["üî• ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏™‡∏π‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (Whale Rider)", "üí∞ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ï‡πã‡∏á)"])

targets = ["SIRI", "WHA", "MTC", "PLANB", "SAWAD", "THCOM"]

if menu == "üî• ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏™‡∏π‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (Whale Rider)":
    st.title("üèπ Whale Rider: ‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏à‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà")
    cols = st.columns(3)
    
    for i, symbol in enumerate(targets):
        with cols[i % 3]:
            with st.expander(f"üê≥ {symbol} Strategy", expanded=True):
                price, rsi_val = get_accurate_rsi(symbol)
                st.metric(f"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î", f"{price:.2f}")
                
                # --- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô ---
                m_bid = st.number_input(f"Bid Vol ({symbol})", value=1000000, key=f"b_{symbol}")
                m_off = st.number_input(f"Offer Vol ({symbol})", value=3000000, key=f"o_{symbol}")
                ratio = m_off / m_bid if m_bid > 0 else 0
                
                # --- ‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ: ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏™‡∏π‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ ---
                st.markdown("---")
                st.subheader("üõ°Ô∏è ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:")
                
                if ratio > 4 and rsi_val > 65:
                    st.error("üÜò **‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: '‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡∏•‡∏ß‡∏á'**")
                    st.write("**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:** ‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏≤‡∏á Offer ‡∏Ç‡∏ß‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏µ‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏≤‡∏∞‡∏Ç‡∏ß‡∏≤! ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≤‡∏¢‡∏î‡∏±‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≥‡πÅ‡∏û‡∏á 1-2 ‡∏ä‡πà‡∏≠‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô WHA 4.28 ‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!)")
                elif ratio < 0.7 and rsi_val < 40:
                    st.success("üíé **‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: '‡∏ã‡∏∏‡πà‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á'**")
                    st.write("**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:** ‡∏ß‡∏≠‡∏•‡∏•‡∏∏‡πà‡∏°‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡πÄ‡∏ö‡∏≤‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏¥‡πà‡∏á RSI ‡∏ï‡πà‡∏≥ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ '‡∏ä‡πâ‡∏≠‡∏ô' ‡πÑ‡∏°‡πâ‡πÅ‡∏£‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà")
                elif ratio < 0.4 and rsi_val > 55:
                    st.warning("üöÄ **‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: '‡∏•‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏ä‡∏≤‡∏Å'**")
                    st.write("**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:** ‡∏ó‡∏≤‡∏á‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏°‡∏≤‡∏Å ‡πÄ‡∏à‡πâ‡∏≤‡∏ñ‡∏≠‡∏ô Offer ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å‡πÇ‡∏ä‡∏ß‡πå Let Profit Run ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡∏î‡πÅ‡∏£‡∏á‡∏™‡πà‡∏á")
                else:
                    st.info("‚öñÔ∏è **‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå: '‡∏î‡∏∂‡∏á‡πÄ‡∏ä‡πá‡∏á/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á'**")
                    st.write("**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:** ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏¢‡∏±‡∏ö ‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏£‡∏≠ Ticker ‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ù‡∏±‡πà‡∏á Buy ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡∏≤‡∏°")

# ==========================================
# üí∞ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏ï‡πà‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ï‡πã‡∏á‡πÄ‡∏õ‡πä‡∏∞)
# ==========================================
elif menu == "üí∞ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ï‡πã‡∏á)":
    st.title("üí∞ Portfolio & Weekly Goal")
    # ... (‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÅ‡∏•‡∏∞ Progress Bar 500 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô v3.2) ...
