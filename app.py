import streamlit as st
import pandas as pd

# ==========================================
# ‚öôÔ∏è UI SETUP
# ==========================================
st.set_page_config(page_title="GeminiBo Manual v2.3", page_icon="üèóÔ∏è", layout="wide")

st.sidebar.title("üèóÔ∏è GeminiBo v2.3")
st.sidebar.info("Engineering Mindset: Manual Control")
menu = st.sidebar.radio("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", ["üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (Wall Ratio)", "üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏° (Recovery)"])

# ==========================================
# üìä MODE 1: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á 100%)
# ==========================================
if menu == "üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (Wall Ratio)":
    st.title("üöÄ Manual Wall Ratio Tracker")
    st.write("‡∏î‡∏π‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å Streaming ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏à‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠")
    
    cols = st.columns(3)
    targets = ["SIRI", "WHA", "MTC"]
    
    # ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡πÇ‡∏ö‡πâ‡∏™‡πà‡∏á‡∏°‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    default_vals = {
        "SIRI": {"bid": 4400000, "off": 2500000}, # ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ image_76df44.png
        "WHA": {"bid": 7292200, "off": 1673800},  # ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ image_6a9581.png
        "MTC": {"bid": 738600, "off": 362900}     # ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ image_6a865e.jpg
    }

    for i, symbol in enumerate(targets):
        with cols[i]:
            st.subheader(f"üìà {symbol}")
            m_price = st.number_input(f"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ({symbol})", value=0.0, step=0.01, format="%.2f", key=f"p_{symbol}")
            m_bid = st.number_input(f"Bid Vol (‡∏£‡∏ß‡∏° 3 ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å)", value=default_vals[symbol]["bid"], step=100000, key=f"b_{symbol}")
            m_off = st.number_input(f"Offer Vol (‡∏£‡∏ß‡∏° 3 ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å)", value=default_vals[symbol]["off"], step=100000, key=f"o_{symbol}")
            
            ratio = m_off / m_bid if m_bid > 0 else 0
            st.metric(f"Wall Ratio ({symbol})", f"{ratio:.2f}")
            
            if ratio > 3: st.warning("‚ö†Ô∏è ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡∏Ç‡∏ß‡∏≤‡∏á (‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏∂‡∏î‡∏≠‡∏±‡∏î)")
            elif ratio < 0.5: st.success("üöÄ ‡∏ó‡∏≤‡∏á‡∏™‡∏∞‡∏î‡∏ß‡∏Å (‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á/‡∏•‡∏≤‡∏Å)")
            else: st.info("‚öñÔ∏è ‡∏ö‡∏µ‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏Ñ‡∏ö (‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á)")

# ==========================================
# üßÆ MODE 2: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏° (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)
# ==========================================
elif menu == "üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏° (Recovery)":
    st.title("üßÆ Recovery Calculator")
    
    tab1, tab2 = st.tabs(["üìâ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ñ‡∏±‡∏ß‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (WHA/MTC)", "üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ñ‡∏≠‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏∑‡∏ô (SIRI)"])
    
    with tab1:
        st.subheader("‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏ß‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏µ‡∏ï‡∏∑‡πâ‡∏ô")
        c1, c2 = st.columns(2)
        old_v = c1.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°", value=1000)
        old_p = c2.number_input("‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏î‡∏¥‡∏°", value=4.22)
        new_v = c1.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°", value=1000)
        new_p = c2.number_input("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏±‡∏ß", value=4.14)
        
        avg = ((old_v * old_p) + (new_v * new_p)) / (old_v + new_v)
        st.success(f"üéØ ‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: {avg:.2f}")

    with tab2:
        st.subheader("‡∏Ç‡∏≤‡∏¢‡∏Å‡∏µ‡πà‡∏´‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏ô? (Free Seed)")
        total_s = st.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ", value=8700)
        cost_p = st.number_input("‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (1.47)", value=1.47)
        target_s = st.number_input("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡∏≤‡∏¢", value=1.65)
        
        money_back = (total_s * cost_p) / target_s
        st.warning(f"üí° ‡∏Ç‡∏≤‡∏¢ {int(money_back):,} ‡∏´‡∏∏‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≠‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏∑‡∏ô")
        st.info(f"üöÄ ‡∏´‡∏∏‡πâ‡∏ô‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ü‡∏£‡∏µ) ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {int(total_s - money_back):,} ‡∏´‡∏∏‡πâ‡∏ô")
